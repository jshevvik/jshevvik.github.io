---
// src/pages/blog/[page].astro
import DefaultLayout from '@layouts/DefaultLayout.astro'
import PageHeader from '@components/PageHeader.astro'
import { Card, Pagination } from 'accessible-astro-components'
import type { PaginateFunction, Page } from 'astro'
import { getCollection } from 'astro:content'

type ListItem = {
  title: string
  body: string
  url: string
  cover?: string
}

export async function getStaticPaths({ paginate }: { paginate: PaginateFunction }) {
  const posts = await getCollection('blog', ({ data }) => !data.draft)
  posts.sort((a, b) => +b.data.pubDate - +a.data.pubDate)

  const items: ListItem[] = posts.map((p) => ({
    title: p.data.title,
    body: p.data.description ?? '',
    url: `/blog/${p.slug}`,
    cover: p.data.coverImage,
  }))

  return paginate(items, { pageSize: 6 })
}

interface Props { page: Page<ListItem> }
const { page } = Astro.props as Props
---

<DefaultLayout title="Blog" description="Artículos sobre Android/Java, Web y Accesibilidad.">
  <PageHeader
    title="Blog"
    subtitle="Artículos y notas de aprendizaje."
    bgType="bordered"
  />

  <section class="my-12">
    <div class="container">
      <p class="text-sm"><em>Post {page.start + 1} a {page.end + 1} de {page.total}</em></p>

      <ul class="my-3 grid grid-cols-1 gap-6 md:grid-cols-2 lg:grid-cols-3">
        {page.data.map((post) => (
          <li>
            <Card
              imageUrl={post.cover ?? undefined}
              url={post.url}
              title={post.title}
              headingLevel="h2"
              fullHeight={true}
            >
              {post.body}
            </Card>
          </li>
        ))}
      </ul>

      <div class="mt-12 grid place-content-center">
        <Pagination
          firstPage={page.url.prev ? '/blog' : null}
          previousPage={page.url.prev ?? null}
          nextPage={page.url.next ?? null}
          lastPage={page.url.next ? `/blog/${Math.ceil(page.total / page.size)}` : null}
          currentPage={`${page.currentPage}`}
          totalPages={`${Math.ceil(page.total / page.size)}`}
          ariaLabel="Paginación del blog"
        />
      </div>
    </div>
  </section>
</DefaultLayout>
