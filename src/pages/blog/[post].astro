---
// src/pages/blog/[post].astro
import DefaultLayout from '@layouts/DefaultLayout.astro'
import PageHeader from '@components/PageHeader.astro'
import SocialShares from '@components/SocialShares.astro'
import BreakoutImage from '@components/BreakoutImage.astro'
import { Heading } from 'accessible-astro-components'
import { getCollection, type CollectionEntry } from 'astro:content'

export async function getStaticPaths() {
  const posts = await getCollection('blog', ({ data }) => !data.draft)

  return posts.map((entry) => ({
    params: { post: entry.slug },
    props: { entry },
  }))
}

const { entry } = Astro.props as { entry: CollectionEntry<'blog'> }
const { title, description, pubDate, coverImage } = entry.data

// Render del MD/MDX
const { Content } = await entry.render()

const author = {
  name: 'Iuliia Shevchenko',
  image: coverImage ?? '/posts/post-image-1.png',
  bio: 'Android & Web dev. Accesibilidad y buenas prácticas.',
}
---

<DefaultLayout title={title} description={description ?? ''} url={'/blog/' + entry.slug}>
  <PageHeader
    title={title}
    subtitle={description ?? ''}
    author={author}
    bgType="bordered"
    featuredImage={coverImage}
  />

  <section class="my-12">
    <div class="narrow container">
      <p class="opacity-80 text-sm mb-6">
        Publicado el {new Date(pubDate).toLocaleDateString('es-ES')}
      </p>
      <article class="prose prose-lg dark:prose-invert max-w-none">
        <Content />
      </article>
    </div>
  </section>

  {coverImage && (
    <section class="my-12">
      <div class="narrow space-content container">
        <Heading level="h3">Galería</Heading>
        <BreakoutImage src={coverImage} alt="Imagen de portada del artículo" />
      </div>
    </section>
  )}

  <section class="my-12">
    <div class="narrow space-content container">
      <Heading level="h2">Compartir</Heading>
      <p>¿Te gustó? ¡Compártelo!</p>
      <SocialShares />
    </div>
  </section>
</DefaultLayout>
